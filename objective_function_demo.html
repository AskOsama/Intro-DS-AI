<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Objective Function Demo | Car Optimization</title>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #1f2937;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --accent-hp: #27ae60;
            --accent-cost: #f97316;
            --accent-pareto: #a855f7;
            --accent-point: #3498db;
            --accent-best: #f1c40f;
        }

        html, body {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .demo-header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            padding: 2rem;
            text-align: center;
        }

        .demo-header h1 {
            margin: 0;
            font-size: 2rem;
        }

        .demo-header p {
            margin: 0.5rem 0 0;
            opacity: 0.9;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .controls-panel {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            align-items: center;
            justify-content: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-group label {
            font-weight: bold;
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .control-group select, .control-group input[type="range"] {
            padding: 0.5rem;
            border-radius: 6px;
            border: 1px solid #374151;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 1rem;
            min-width: 150px;
        }

        .btn-group {
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--accent-hp);
            color: white;
        }

        .btn-primary:hover {
            background: #219a52;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 2px solid #374151;
        }

        .btn-secondary:hover {
            border-color: var(--accent-point);
        }

        .status-bar {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
            justify-content: center;
        }

        .status-item {
            text-align: center;
        }

        .status-item .value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .status-item .label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .status-item.hp .value { color: var(--accent-hp); }
        .status-item.cost .value { color: var(--accent-cost); }
        .status-item.pareto .value { color: var(--accent-pareto); }

        .viz-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .viz-title {
            text-align: center;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .scatter-plot {
            position: relative;
            width: 100%;
            height: 450px;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .axis-label {
            position: absolute;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .axis-label.x-axis {
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
        }

        .axis-label.y-axis {
            left: 5px;
            top: 50%;
            transform: rotate(-90deg) translateX(-50%);
            transform-origin: left center;
        }

        .car-point {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent-point);
            border: 2px solid #2980b9;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
        }

        .car-point:hover {
            transform: translate(-50%, -50%) scale(1.3);
            z-index: 20;
        }

        .car-point.pareto {
            background: var(--accent-pareto);
            border-color: #8e44ad;
        }

        .car-point.best-hp {
            background: var(--accent-hp);
            border-color: #1e8449;
            box-shadow: 0 0 10px var(--accent-hp);
        }

        .car-point.best-cost {
            background: var(--accent-cost);
            border-color: #d35400;
            box-shadow: 0 0 10px var(--accent-cost);
        }

        .car-point.winner {
            width: 24px;
            height: 24px;
            border-width: 3px;
            box-shadow: 0 0 15px var(--accent-best), 0 0 30px var(--accent-best);
            animation: winner-pulse 1s ease-in-out infinite;
            z-index: 25;
        }

        @keyframes winner-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        .car-point.searched {
            opacity: 1;
        }

        .car-point.unsearched {
            opacity: 0.3;
        }

        .pareto-line {
            position: absolute;
            pointer-events: none;
            z-index: 5;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
            pointer-events: none;
            z-index: 100;
            white-space: nowrap;
            display: none;
        }

        .data-table-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .data-table th, .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #374151;
        }

        .data-table th {
            background: var(--bg-card);
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .data-table th:hover {
            color: var(--accent-point);
        }

        .data-table tr:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .data-table .pareto-yes {
            color: var(--accent-pareto);
            font-weight: bold;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }

        .legend-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }

        .legend-dot.normal { background: var(--accent-point); }
        .legend-dot.pareto { background: var(--accent-pareto); }
        .legend-dot.best-hp { background: var(--accent-hp); }
        .legend-dot.best-cost { background: var(--accent-cost); }

        .back-link {
            display: inline-block;
            margin-top: 1.5rem;
            color: var(--accent-point);
            text-decoration: none;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .grid-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.05);
        }

        .grid-line.horizontal {
            width: 100%;
            height: 1px;
        }

        .grid-line.vertical {
            width: 1px;
            height: 100%;
        }

        .tick-label {
            position: absolute;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .controls-panel {
                flex-direction: column;
            }

            .scatter-plot {
                height: 350px;
            }

            .status-bar {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="demo-header">
        <h1>Objective Function Demo</h1>
        <p>Explore Single vs Multi-Objective Optimization with Car Data</p>
    </header>

    <div class="demo-container">
        <div class="controls-panel">
            <div class="control-group">
                <label>Data Size</label>
                <select id="dataSize">
                    <option value="20">20 Cars</option>
                    <option value="50" selected>50 Cars</option>
                    <option value="100">100 Cars</option>
                </select>
            </div>

            <div class="control-group">
                <label>Visualization Mode</label>
                <select id="vizMode">
                    <option value="single-hp">Single: Max Horsepower</option>
                    <option value="single-cost">Single: Min Cost</option>
                    <option value="two-obj" selected>Two Objectives</option>
                    <option value="pareto">Show Pareto Front</option>
                </select>
            </div>

            <div class="control-group">
                <label>Animation Speed</label>
                <input type="range" id="speed" min="50" max="500" value="200">
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" id="btnRun">Run Search</button>
                <button class="btn btn-secondary" id="btnReset">Reset</button>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="value" id="searchProgress">0 / 0</div>
                <div class="label">Cars Searched</div>
            </div>
            <div class="status-item hp">
                <div class="value" id="bestHP">-</div>
                <div class="label">Best Horsepower</div>
            </div>
            <div class="status-item cost">
                <div class="value" id="bestCost">-</div>
                <div class="label">Best Cost</div>
            </div>
            <div class="status-item pareto">
                <div class="value" id="paretoCount">-</div>
                <div class="label">Pareto Optimal</div>
            </div>
        </div>

        <div class="viz-container">
            <div class="viz-title" id="vizTitle">Two Objectives: Horsepower vs Cost</div>
            <div class="scatter-plot" id="scatterPlot">
                <div class="axis-label x-axis">Horsepower (HP) - Higher is Better →</div>
                <div class="axis-label y-axis">← Lower is Better - Cost ($)</div>
                <div class="tooltip" id="tooltip"></div>
                <svg class="pareto-line" id="paretoLine" width="100%" height="100%"></svg>
            </div>
            <div class="legend">
                <div class="legend-item"><div class="legend-dot normal"></div> Regular Car</div>
                <div class="legend-item"><div class="legend-dot pareto"></div> Pareto Optimal</div>
                <div class="legend-item"><div class="legend-dot best-hp"></div> Best HP</div>
                <div class="legend-item"><div class="legend-dot best-cost"></div> Best Cost</div>
            </div>
        </div>

        <div class="data-table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th data-sort="id">ID</th>
                        <th data-sort="name">Name</th>
                        <th data-sort="horsepower">Horsepower</th>
                        <th data-sort="cost">Cost</th>
                        <th data-sort="is_pareto">Pareto?</th>
                    </tr>
                </thead>
                <tbody id="carTableBody">
                </tbody>
            </table>
        </div>

        <a href="session1_week4.html#objective-functions" class="back-link">← Back to Lesson</a>
    </div>

    <script src="js/cars_data.js"></script>
    <script>
        // State management
        const state = {
            cars: [],
            selectedCars: [],
            dataSize: 50,
            mode: 'two-obj',
            searchStep: 0,
            searchOrder: [],
            bestHP: null,
            bestCost: null,
            isRunning: false,
            animationSpeed: 200
        };

        // DOM elements
        const elements = {
            dataSize: document.getElementById('dataSize'),
            vizMode: document.getElementById('vizMode'),
            speed: document.getElementById('speed'),
            btnRun: document.getElementById('btnRun'),
            btnReset: document.getElementById('btnReset'),
            searchProgress: document.getElementById('searchProgress'),
            bestHP: document.getElementById('bestHP'),
            bestCost: document.getElementById('bestCost'),
            paretoCount: document.getElementById('paretoCount'),
            vizTitle: document.getElementById('vizTitle'),
            scatterPlot: document.getElementById('scatterPlot'),
            carTableBody: document.getElementById('carTableBody'),
            tooltip: document.getElementById('tooltip'),
            paretoLine: document.getElementById('paretoLine')
        };

        // Initialize
        function init() {
            state.cars = [...CARS_DATA];
            setupEventListeners();
            generateData();
        }

        // Event listeners
        function setupEventListeners() {
            elements.dataSize.addEventListener('change', (e) => {
                state.dataSize = parseInt(e.target.value);
                generateData();
            });

            elements.vizMode.addEventListener('change', (e) => {
                state.mode = e.target.value;
                updateVizTitle();
                renderScatterPlot();
            });

            elements.speed.addEventListener('input', (e) => {
                state.animationSpeed = 550 - parseInt(e.target.value);
            });

            elements.btnRun.addEventListener('click', toggleSearch);
            elements.btnReset.addEventListener('click', resetVisualization);

            // Table sorting
            document.querySelectorAll('.data-table th').forEach(th => {
                th.addEventListener('click', () => sortTable(th.dataset.sort));
            });
        }

        // Generate random subset
        function generateData() {
            const shuffled = [...state.cars].sort(() => Math.random() - 0.5);
            state.selectedCars = shuffled.slice(0, state.dataSize);
            state.searchOrder = state.selectedCars.map((_, i) => i).sort(() => Math.random() - 0.5);
            state.searchStep = 0;
            state.bestHP = null;
            state.bestCost = null;
            state.isRunning = false;

            updateStatus();
            renderScatterPlot();
            renderTable();
        }

        // Update visualization title
        function updateVizTitle() {
            const titles = {
                'single-hp': 'Single Objective: Maximize Horsepower',
                'single-cost': 'Single Objective: Minimize Cost',
                'two-obj': 'Two Objectives: Horsepower vs Cost',
                'pareto': 'Pareto Front: Optimal Trade-offs'
            };
            elements.vizTitle.textContent = titles[state.mode];
        }

        // Toggle search animation
        function toggleSearch() {
            if (state.isRunning) {
                state.isRunning = false;
                elements.btnRun.textContent = 'Resume';
            } else {
                state.isRunning = true;
                elements.btnRun.textContent = 'Pause';
                runSearchStep();
            }
        }

        // Run one search step
        function runSearchStep() {
            if (!state.isRunning) return;
            if (state.searchStep >= state.searchOrder.length) {
                finishSearch();
                return;
            }

            const carIndex = state.searchOrder[state.searchStep];
            const car = state.selectedCars[carIndex];

            // Update best HP
            if (!state.bestHP || car.horsepower > state.bestHP.horsepower) {
                state.bestHP = car;
            }

            // Update best Cost
            if (!state.bestCost || car.cost < state.bestCost.cost) {
                state.bestCost = car;
            }

            state.searchStep++;
            updateStatus();
            renderScatterPlot();
            renderTable();

            setTimeout(runSearchStep, state.animationSpeed);
        }

        // Finish search
        function finishSearch() {
            state.isRunning = false;
            elements.btnRun.textContent = 'Search Complete';
            elements.btnRun.disabled = true;

            // Reveal Pareto status in table
            renderTable();

            // If in Pareto mode, draw Pareto line
            if (state.mode === 'pareto') {
                drawParetoLine();
            }
        }

        // Reset visualization
        function resetVisualization() {
            generateData();
            elements.btnRun.textContent = 'Run Search';
            elements.btnRun.disabled = false;
        }

        // Update status bar
        function updateStatus() {
            elements.searchProgress.textContent = `${state.searchStep} / ${state.selectedCars.length}`;
            elements.bestHP.textContent = state.bestHP ? `${state.bestHP.horsepower} HP` : '-';
            elements.bestCost.textContent = state.bestCost ? `$${state.bestCost.cost.toLocaleString()}` : '-';

            const paretoCount = state.selectedCars.filter(c => c.is_pareto).length;
            elements.paretoCount.textContent = paretoCount;
        }

        // Render scatter plot
        function renderScatterPlot() {
            // Clear existing points
            const existingPoints = elements.scatterPlot.querySelectorAll('.car-point, .grid-line, .tick-label');
            existingPoints.forEach(p => p.remove());

            // Clear Pareto line
            elements.paretoLine.innerHTML = '';

            const plotWidth = elements.scatterPlot.clientWidth;
            const plotHeight = elements.scatterPlot.clientHeight;
            const padding = { left: 60, right: 30, top: 30, bottom: 50 };

            // Data ranges
            const hpMin = 100, hpMax = 700;
            const costMin = 10000, costMax = 140000;

            // Scale functions
            const xScale = (hp) => padding.left + (hp - hpMin) / (hpMax - hpMin) * (plotWidth - padding.left - padding.right);
            const yScale = (cost) => plotHeight - padding.bottom - (cost - costMin) / (costMax - costMin) * (plotHeight - padding.top - padding.bottom);

            // Draw grid
            for (let hp = 200; hp <= 600; hp += 100) {
                const x = xScale(hp);
                const gridLine = document.createElement('div');
                gridLine.className = 'grid-line vertical';
                gridLine.style.left = `${x}px`;
                gridLine.style.top = `${padding.top}px`;
                gridLine.style.height = `${plotHeight - padding.top - padding.bottom}px`;
                elements.scatterPlot.appendChild(gridLine);

                const tickLabel = document.createElement('div');
                tickLabel.className = 'tick-label';
                tickLabel.style.left = `${x}px`;
                tickLabel.style.bottom = `${padding.bottom - 20}px`;
                tickLabel.style.transform = 'translateX(-50%)';
                tickLabel.textContent = hp;
                elements.scatterPlot.appendChild(tickLabel);
            }

            for (let cost = 20000; cost <= 120000; cost += 20000) {
                const y = yScale(cost);
                const gridLine = document.createElement('div');
                gridLine.className = 'grid-line horizontal';
                gridLine.style.left = `${padding.left}px`;
                gridLine.style.top = `${y}px`;
                gridLine.style.width = `${plotWidth - padding.left - padding.right}px`;
                elements.scatterPlot.appendChild(gridLine);

                const tickLabel = document.createElement('div');
                tickLabel.className = 'tick-label';
                tickLabel.style.left = `${padding.left - 5}px`;
                tickLabel.style.top = `${y}px`;
                tickLabel.style.transform = 'translateY(-50%)';
                tickLabel.style.textAlign = 'right';
                tickLabel.textContent = `$${(cost/1000)}k`;
                elements.scatterPlot.appendChild(tickLabel);
            }

            // Draw points
            state.selectedCars.forEach((car, idx) => {
                const isSearched = state.searchOrder.indexOf(idx) < state.searchStep;

                const point = document.createElement('div');
                point.className = 'car-point';

                if (isSearched) {
                    point.classList.add('searched');
                } else {
                    point.classList.add('unsearched');
                }

                // Highlight special points based on mode
                if (state.mode === 'single-hp') {
                    // Single objective: Only HP matters - highlight winner
                    if (state.bestHP && car.id === state.bestHP.id && isSearched) {
                        point.classList.add('best-hp');
                        point.classList.add('winner');
                    }
                } else if (state.mode === 'single-cost') {
                    // Single objective: Only cost matters - highlight winner
                    if (state.bestCost && car.id === state.bestCost.id && isSearched) {
                        point.classList.add('best-cost');
                        point.classList.add('winner');
                    }
                } else if (state.mode === 'two-obj') {
                    // Two objectives: Show conflict - both best HP and best cost
                    if (state.bestHP && car.id === state.bestHP.id && isSearched) {
                        point.classList.add('best-hp');
                    }
                    if (state.bestCost && car.id === state.bestCost.id && isSearched) {
                        point.classList.add('best-cost');
                    }
                } else if (state.mode === 'pareto') {
                    // Pareto mode: Highlight all Pareto-optimal cars
                    if (car.is_pareto && isSearched) {
                        point.classList.add('pareto');
                        point.classList.add('winner');
                    }
                }

                const x = xScale(car.horsepower);
                const y = yScale(car.cost);

                point.style.left = `${x}px`;
                point.style.top = `${y}px`;

                // Tooltip events
                point.addEventListener('mouseenter', (e) => {
                    elements.tooltip.style.display = 'block';
                    elements.tooltip.innerHTML = `<strong>${car.name}</strong><br>HP: ${car.horsepower}<br>Cost: $${car.cost.toLocaleString()}${car.is_pareto ? '<br><span style="color:#a855f7">Pareto Optimal</span>' : ''}`;
                    elements.tooltip.style.left = `${x + 15}px`;
                    elements.tooltip.style.top = `${y - 15}px`;
                });

                point.addEventListener('mouseleave', () => {
                    elements.tooltip.style.display = 'none';
                });

                elements.scatterPlot.appendChild(point);
            });

            // Draw Pareto line if mode is pareto and search complete
            if (state.mode === 'pareto' && state.searchStep >= state.searchOrder.length) {
                drawParetoLine();
            }
        }

        // Draw Pareto front line
        function drawParetoLine() {
            const plotWidth = elements.scatterPlot.clientWidth;
            const plotHeight = elements.scatterPlot.clientHeight;
            const padding = { left: 60, right: 30, top: 30, bottom: 50 };

            const hpMin = 100, hpMax = 700;
            const costMin = 10000, costMax = 140000;

            const xScale = (hp) => padding.left + (hp - hpMin) / (hpMax - hpMin) * (plotWidth - padding.left - padding.right);
            const yScale = (cost) => plotHeight - padding.bottom - (cost - costMin) / (costMax - costMin) * (plotHeight - padding.top - padding.bottom);

            // Get Pareto optimal cars sorted by HP
            const paretoCars = state.selectedCars
                .filter(c => c.is_pareto)
                .sort((a, b) => a.horsepower - b.horsepower);

            if (paretoCars.length < 2) return;

            // Create path
            let pathD = `M ${xScale(paretoCars[0].horsepower)} ${yScale(paretoCars[0].cost)}`;
            for (let i = 1; i < paretoCars.length; i++) {
                pathD += ` L ${xScale(paretoCars[i].horsepower)} ${yScale(paretoCars[i].cost)}`;
            }

            elements.paretoLine.innerHTML = `
                <path d="${pathD}" fill="none" stroke="#a855f7" stroke-width="3" stroke-dasharray="8,4"/>
            `;
        }

        // Render data table - progressive discovery
        function renderTable() {
            elements.carTableBody.innerHTML = '';
            const searchComplete = state.searchStep >= state.searchOrder.length;

            state.selectedCars.forEach((car, idx) => {
                const isSearched = state.searchOrder.indexOf(idx) < state.searchStep;

                if (!isSearched) return; // Don't show unsearched cars

                const row = document.createElement('tr');
                const paretoDisplay = searchComplete
                    ? (car.is_pareto ? 'Yes' : 'No')
                    : '?';
                const paretoClass = searchComplete && car.is_pareto ? 'pareto-yes' : '';

                row.innerHTML = `
                    <td>${car.id}</td>
                    <td>${car.name}</td>
                    <td>${car.horsepower} HP</td>
                    <td>$${car.cost.toLocaleString()}</td>
                    <td class="${paretoClass}">${paretoDisplay}</td>
                `;
                elements.carTableBody.appendChild(row);
            });
        }

        // Sort table
        function sortTable(column) {
            state.selectedCars.sort((a, b) => {
                if (column === 'is_pareto') {
                    return (b.is_pareto ? 1 : 0) - (a.is_pareto ? 1 : 0);
                }
                if (typeof a[column] === 'number') {
                    return b[column] - a[column];
                }
                return a[column].localeCompare(b[column]);
            });
            renderTable();
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            renderScatterPlot();
        });

        // Start
        init();
    </script>
</body>
</html>
