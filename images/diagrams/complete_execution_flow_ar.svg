<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700" width="900" height="700">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50"/>
    </marker>
    <marker id="greenarrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#27ae60"/>
    </marker>
    <linearGradient id="codeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e8f4fc;stop-opacity:1"/>
      <stop offset="100%" style="stop-color:#d4e9f7;stop-opacity:1"/>
    </linearGradient>
  </defs>

  <!-- Title -->
  <text x="450" y="30" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#2c3e50" text-anchor="middle">تدفق التنفيذ الكامل</text>

  <!-- Column headers -->
  <text x="750" y="60" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666" text-anchor="middle">الكود الخاص بك</text>
  <text x="200" y="60" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#666" text-anchor="middle">النظام الموزع</text>

  <!-- Divider line -->
  <line x1="550" y1="50" x2="550" y2="680" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="8,4"/>

  <!-- Code box -->
  <rect x="590" y="80" width="280" height="110" rx="8" fill="url(#codeGrad)" stroke="#3498db" stroke-width="2"/>
  <text x="610" y="105" font-family="monospace" font-size="11" fill="#333" direction="ltr">f1 = submit(load)</text>
  <text x="610" y="125" font-family="monospace" font-size="11" fill="#333" direction="ltr">f2 = submit(A, f1)</text>
  <text x="610" y="145" font-family="monospace" font-size="11" fill="#333" direction="ltr">f3 = submit(B, f1)</text>
  <text x="610" y="165" font-family="monospace" font-size="11" fill="#333" direction="ltr">f4 = submit(C, f2, f3)</text>

  <!-- Arrow to futures creation -->
  <line x1="590" y1="135" x2="500" y2="135" stroke="#3498db" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Futures created text -->
  <text x="480" y="105" font-family="Arial, sans-serif" font-size="11" fill="#3498db" text-anchor="end">ينشئ Future #1</text>
  <text x="480" y="125" font-family="Arial, sans-serif" font-size="11" fill="#3498db" text-anchor="end">ينشئ Future #2 (يعتمد على #1)</text>
  <text x="480" y="145" font-family="Arial, sans-serif" font-size="11" fill="#3498db" text-anchor="end">ينشئ Future #3 (يعتمد على #1)</text>
  <text x="480" y="165" font-family="Arial, sans-serif" font-size="11" fill="#3498db" text-anchor="end">ينشئ Future #4 (يعتمد على #2 و #3)</text>

  <!-- Result trigger -->
  <rect x="590" y="210" width="280" height="50" rx="8" fill="#fff3cd" stroke="#ffc107" stroke-width="2"/>
  <text x="730" y="235" font-family="monospace" font-size="12" fill="#333" text-anchor="middle" direction="ltr">f4.result()</text>
  <text x="730" y="250" font-family="Arial, sans-serif" font-size="10" fill="#666" text-anchor="middle">(بدء التنفيذ)</text>

  <!-- Arrow to scheduler -->
  <line x1="590" y1="235" x2="450" y2="290" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Scheduler box 1 -->
  <rect x="60" y="280" width="420" height="100" rx="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="270" y="305" font-family="Arial, sans-serif" font-size="14" fill="white" text-anchor="middle" font-weight="bold">المُجدوِل</text>
  <text x="450" y="330" font-family="Arial, sans-serif" font-size="11" fill="#e8f4fc" text-anchor="end">1. يحلل الـ DAG:</text>
  <text x="350" y="350" font-family="monospace" font-size="10" fill="#fff" text-anchor="middle">f1 ──┬──► f2 ──┐</text>
  <text x="350" y="365" font-family="monospace" font-size="10" fill="#fff" text-anchor="middle">     └──► f3 ──┴──► f4</text>

  <!-- Arrow to Worker 1 -->
  <line x1="270" y1="380" x2="270" y2="410" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Worker 1 - executes f1 -->
  <rect x="160" y="420" width="220" height="70" rx="8" fill="#27ae60" stroke="#1e8449" stroke-width="2"/>
  <text x="270" y="445" font-family="Arial, sans-serif" font-size="13" fill="white" text-anchor="middle" font-weight="bold">العامل 1</text>
  <text x="270" y="465" font-family="Arial, sans-serif" font-size="11" fill="#d4edda" text-anchor="middle">ينفذ f1 (تحميل البيانات)</text>
  <text x="270" y="480" font-family="Arial, sans-serif" font-size="11" fill="#d4edda" text-anchor="middle">الحالة: f1 = اكتمل ✓</text>

  <!-- Arrow back to scheduler -->
  <line x1="270" y1="490" x2="270" y2="515" stroke="#27ae60" stroke-width="2" marker-end="url(#greenarrow)"/>

  <!-- Scheduler box 2 -->
  <rect x="60" y="520" width="420" height="55" rx="8" fill="#e67e22" stroke="#d35400" stroke-width="2"/>
  <text x="270" y="545" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle" font-weight="bold">المجدول: f1 انتهى! من ينتظر؟</text>
  <text x="270" y="565" font-family="Arial, sans-serif" font-size="11" fill="#fef9e7" text-anchor="middle">← f2 (جاهز!) ← العامل 2    ← f3 (جاهز!) ← العامل 3</text>

  <!-- Arrows to parallel workers -->
  <line x1="170" y1="575" x2="90" y2="610" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="370" y1="575" x2="450" y2="610" stroke="#2c3e50" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Worker 2 -->
  <rect x="10" y="610" width="160" height="55" rx="8" fill="#9b59b6" stroke="#7d3c98" stroke-width="2"/>
  <text x="90" y="635" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle" font-weight="bold">العامل 2</text>
  <text x="90" y="655" font-family="Arial, sans-serif" font-size="10" fill="#ebdef0" text-anchor="middle">f2 = اكتمل ✓</text>

  <!-- Worker 3 -->
  <rect x="370" y="610" width="160" height="55" rx="8" fill="#9b59b6" stroke="#7d3c98" stroke-width="2"/>
  <text x="450" y="635" font-family="Arial, sans-serif" font-size="12" fill="white" text-anchor="middle" font-weight="bold">العامل 3</text>
  <text x="450" y="655" font-family="Arial, sans-serif" font-size="10" fill="#ebdef0" text-anchor="middle">f3 = اكتمل ✓</text>

  <!-- Final result back to code -->
  <rect x="590" y="620" width="280" height="50" rx="8" fill="#d4edda" stroke="#27ae60" stroke-width="2"/>
  <text x="730" y="645" font-family="monospace" font-size="12" fill="#333" text-anchor="middle" direction="ltr">f4.result()</text>
  <text x="730" y="660" font-family="Arial, sans-serif" font-size="10" fill="#27ae60" text-anchor="middle">يُرجع: [النتيجة المدمجة]</text>

  <!-- Arrow back from workers to result -->
  <line x1="530" y1="645" x2="590" y2="645" stroke="#27ae60" stroke-width="2" marker-end="url(#greenarrow)"/>
  <text x="560" y="635" font-family="Arial, sans-serif" font-size="9" fill="#27ae60">النتيجة!</text>
</svg>