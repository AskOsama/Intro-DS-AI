<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 300">
  <defs>
    <linearGradient id="dataGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2980b9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="modelGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#9b59b6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#8e44ad;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="lossGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e74c3c;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c0392b;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="updateGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#27ae60;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1e8449;stop-opacity:1" />
    </linearGradient>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#3498db"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#27ae60"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="3" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
  </defs>

  <!-- Title -->
  <text x="400" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50" text-anchor="middle">The Training Loop</text>

  <!-- Step 1: Data Input -->
  <g transform="translate(30, 70)">
    <rect x="0" y="0" width="120" height="80" rx="10" fill="url(#dataGrad)" filter="url(#shadow)"/>
    <text x="60" y="35" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Training</text>
    <text x="60" y="52" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Data</text>
    <text x="60" y="70" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)" text-anchor="middle">(X, y)</text>
  </g>

  <!-- Arrow 1 -->
  <path d="M155 110 L195 110" stroke="#3498db" stroke-width="3" marker-end="url(#arrowBlue)"/>
  <text x="175" y="100" font-family="Arial, sans-serif" font-size="10" fill="#3498db" text-anchor="middle">input</text>

  <!-- Step 2: Model -->
  <g transform="translate(200, 70)">
    <rect x="0" y="0" width="120" height="80" rx="10" fill="url(#modelGrad)" filter="url(#shadow)"/>
    <text x="60" y="35" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Model</text>
    <text x="60" y="52" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.8)" text-anchor="middle">f(x; w)</text>
    <text x="60" y="70" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.7)" text-anchor="middle">weights</text>
  </g>

  <!-- Arrow 2 -->
  <path d="M325 110 L365 110" stroke="#9b59b6" stroke-width="3" marker-end="url(#arrowBlue)"/>
  <text x="345" y="100" font-family="Arial, sans-serif" font-size="10" fill="#9b59b6" text-anchor="middle">predict</text>

  <!-- Step 3: Prediction -->
  <g transform="translate(370, 70)">
    <rect x="0" y="0" width="120" height="80" rx="10" fill="#f39c12" filter="url(#shadow)"/>
    <text x="60" y="35" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Prediction</text>
    <text x="60" y="55" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.8)" text-anchor="middle">y_hat</text>
  </g>

  <!-- Arrow 3 -->
  <path d="M495 110 L535 110" stroke="#f39c12" stroke-width="3" marker-end="url(#arrowBlue)"/>
  <text x="515" y="100" font-family="Arial, sans-serif" font-size="10" fill="#f39c12" text-anchor="middle">compare</text>

  <!-- Step 4: Loss Calculation -->
  <g transform="translate(540, 70)">
    <rect x="0" y="0" width="120" height="80" rx="10" fill="url(#lossGrad)" filter="url(#shadow)"/>
    <text x="60" y="30" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Calculate</text>
    <text x="60" y="47" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="white" text-anchor="middle">Loss</text>
    <text x="60" y="67" font-family="Arial, sans-serif" font-size="10" fill="rgba(255,255,255,0.8)" text-anchor="middle">L(y, y_hat)</text>
  </g>

  <!-- Arrow 4: Backward -->
  <path d="M600 155 L600 200 L260 200 L260 155" stroke="#e74c3c" stroke-width="3" fill="none" stroke-dasharray="6,3" marker-end="url(#arrowRed)"/>
  <text x="430" y="220" font-family="Arial, sans-serif" font-size="11" fill="#e74c3c" text-anchor="middle" font-weight="bold">Backpropagation (Calculate Gradients)</text>

  <!-- Step 5: Update Weights -->
  <g transform="translate(200, 230)">
    <rect x="0" y="0" width="120" height="50" rx="10" fill="url(#updateGrad)" filter="url(#shadow)"/>
    <text x="60" y="22" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white" text-anchor="middle">Update</text>
    <text x="60" y="40" font-family="Arial, sans-serif" font-size="11" fill="rgba(255,255,255,0.8)" text-anchor="middle">w = w - lr * grad</text>
  </g>

  <!-- Arrow: Back to model -->
  <path d="M260 225 L260 155" stroke="#27ae60" stroke-width="3" marker-end="url(#arrowGreen)"/>

  <!-- Labels for forward/backward -->
  <rect x="680" y="90" width="100" height="70" rx="8" fill="#f8f9fa" stroke="#ddd"/>
  <text x="730" y="115" font-family="Arial, sans-serif" font-size="11" fill="#3498db" text-anchor="middle" font-weight="bold">Forward Pass</text>
  <path d="M690 125 L770 125" stroke="#3498db" stroke-width="2" marker-end="url(#arrowBlue)"/>
  <text x="730" y="145" font-family="Arial, sans-serif" font-size="11" fill="#e74c3c" text-anchor="middle" font-weight="bold">Backward Pass</text>
  <path d="M770 155 L690 155" stroke="#e74c3c" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrowRed)"/>

  <!-- Repeat indicator -->
  <text x="90" y="270" font-family="Arial, sans-serif" font-size="12" fill="#666" text-anchor="middle" font-style="italic">Repeat for many epochs</text>
  <path d="M30 255 Q10 200 30 150" stroke="#666" stroke-width="1.5" fill="none" stroke-dasharray="3,2" marker-end="url(#arrowBlue)"/>
</svg>
